(window.webpackJsonp=window.webpackJsonp||[]).push([[266],{713:function(t,a,s){"use strict";s.r(a);var n=s(10),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"webrtc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webrtc"}},[t._v("#")]),t._v(" WebRTC")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://www.gausszhou.top/source/data/image/learn/webrtc/mesh-sfu-mcu.jpg",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"webrtc是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webrtc是什么"}},[t._v("#")]),t._v(" WebRTC是什么 ？")]),t._v(" "),s("p",[t._v("WebRTC 是由一家名为 Gobal IP Solutions，简称 GIPS 的瑞典公司开发的。Google 在 2011 年收购了 GIPS，并将其源代码开源。")]),t._v(" "),s("p",[t._v("简单来说，WebRTC 是一个可以在 Web 应用程序中实现音频，视频和数据的实时通信的开源项目。在实时通信中，音视频的采集和处理是一个很复杂的过程。比如音视频流的编解码、降噪和回声消除等，但是在 WebRTC 中，这一切都交由浏览器的底层封装来完成。我们可以直接拿到优化后的媒体流，然后将其输出到本地屏幕和扬声器，或者转发给其对等端。")]),t._v(" "),s("p",[t._v("我们可以在不需要任何第三方插件的情况下，实现一个浏览器到浏览器的点对点（P2P）连接，从而进行音视频实时通信。")]),t._v(" "),s("h3",{attrs:{id:"webrtc-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webrtc-api"}},[t._v("#")]),t._v(" WebRTC API")]),t._v(" "),s("p",[t._v("WebRTC 提供了一些 API 供我们使用，在实时音视频通信的过程中，我们主要用到以下：")]),t._v(" "),s("ul",[s("li",[t._v("mediaDevices")]),t._v(" "),s("li",[t._v("getUserMedia：获取音频和视频流（MediaStream）")]),t._v(" "),s("li",[t._v("RTCPeerConnection：点对点通信")]),t._v(" "),s("li",[t._v("RTCDataChannel：数据通信")]),t._v(" "),s("li",[t._v("MediaStream API：媒体流")])]),t._v(" "),s("h3",{attrs:{id:"mediadevices-媒体设备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mediadevices-媒体设备"}},[t._v("#")]),t._v(" MediaDevices 媒体设备")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("MediaDevices")])]),t._v(" 接口提供访问连接媒体输入的设备，如照相机和麦克风，以及屏幕共享等。它可以使你取得任何硬件资源的媒体数据。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("事件")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("devicechange")]),t._v(" "),s("td",[t._v("每当媒体设备连接到系统或从系统中移除时")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("方法")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("enumerateDevices()")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("getSupportedConstraints()")]),t._v(" "),s("td",[t._v("返回一个对象，指明设备支持那些配置参数")])]),t._v(" "),s("tr",[s("td",[t._v("getDisplayMedia()")]),t._v(" "),s("td",[t._v("获取显示器或者窗口")])]),t._v(" "),s("tr",[s("td",[t._v("getUserMedia()")]),t._v(" "),s("td",[t._v("获取摄像头，麦克风，屏幕共享")])])])]),t._v(" "),s("p",[s("code",[t._v("MediaDevices.getUserMedia()")]),t._v(" 会提示用户给予使用媒体输入的许可，媒体输入会产生一个"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MediaStream",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaStream")]),s("OutboundLink")],1),t._v("，里面包含了请求的媒体类型的轨道。返回一个"),s("code",[t._v("Promise")]),t._v("对象，由于用户不是必须选择所以可能既不会"),s("code",[t._v("resolve")]),t._v("也不会"),s("code",[t._v("reject")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" video "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'video'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" constraints "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" audio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" video"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" width"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1280")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" height"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("720")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nnavigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mediaDevices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserMedia")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constraints"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("stream")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    video"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srcObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"mediastream-媒体流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mediastream-媒体流"}},[t._v("#")]),t._v(" MediaStream 媒体流")]),t._v(" "),s("p",[t._v("MediaStream表示一个媒体流对象，一个流包含几个"),s("em",[t._v("轨道")]),t._v("，比如视频和音频轨道")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性")]),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("active")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("这个流是否处于活动状态")])]),t._v(" "),s("tr",[s("td",[t._v("ended")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("这个流是否被完全读取")])]),t._v(" "),s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("这个流对象的唯一标识符")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("事件")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("onaddtrack")]),t._v(" "),s("td",[t._v("一个MediaStreamTrack对象添加到这个流时")])]),t._v(" "),s("tr",[s("td",[t._v("onended")]),t._v(" "),s("td",[t._v("当流终止时")])]),t._v(" "),s("tr",[s("td",[t._v("onremovetrack")]),t._v(" "),s("td",[t._v("当一个MediaStreamTrack从这个流上移除时")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("其他方法")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("MediaStream.addTrack()")]),t._v(" "),s("td",[t._v("添加一个Track")])]),t._v(" "),s("tr",[s("td",[t._v("MediaStream.removeTrack()")]),t._v(" "),s("td",[t._v("删除一个Track")])]),t._v(" "),s("tr",[s("td",[t._v("MediaStream.clone()")]),t._v(" "),s("td",[t._v("克隆一个MediaStream，会有一个新的ID")])]),t._v(" "),s("tr",[s("td",[t._v("MediaStream.getTracks()")]),t._v(" "),s("td",[t._v("返回一个列表，所有Track")])]),t._v(" "),s("tr",[s("td",[t._v("MediaStream.getAudioTracks()")]),t._v(" "),s("td",[t._v("返回一个列表，所有AudioTrack")])]),t._v(" "),s("tr",[s("td",[t._v("MediaStream.getVideoTracks()")]),t._v(" "),s("td",[t._v("返回一个列表，所有VideoTrack")])]),t._v(" "),s("tr",[s("td",[t._v("MediaStream.getTrackById()")]),t._v(" "),s("td",[t._v("按ID查找Track")])])])]),t._v(" "),s("h3",{attrs:{id:"mediastreamtrack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mediastreamtrack"}},[t._v("#")]),t._v(" MediaStreamTrack")]),t._v(" "),s("p",[t._v("MediaStreamTrack接口在User Agent中表示一段媒体源，比如音轨或视频")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性")]),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("enabled")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("表示轨道是否有效")])]),t._v(" "),s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("唯一标识符")])]),t._v(" "),s("tr",[s("td",[t._v("kind")]),t._v(" "),s("td",[t._v("video/audio")]),t._v(" "),s("td",[t._v("表示轨道类型")])]),t._v(" "),s("tr",[s("td",[t._v("label")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("用户指定的标签")])]),t._v(" "),s("tr",[s("td",[t._v("muted")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("表示轨道是否为静音")])]),t._v(" "),s("tr",[s("td",[t._v("readonly")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("表示轨道是否只读，不能被修改")])]),t._v(" "),s("tr",[s("td",[t._v("readyState")]),t._v(" "),s("td",[t._v("live/ended")]),t._v(" "),s("td",[t._v("表示轨道的当前状态")])]),t._v(" "),s("tr",[s("td",[t._v("remote")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("表示数据是否时RTC提供的")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("事件")]),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("onstarted")]),t._v(" "),s("td",[t._v("onmute")]),t._v(" "),s("td",[t._v("onunmete")])]),t._v(" "),s("tr",[s("td",[t._v("onoversonstrained")]),t._v(" "),s("td",[t._v("onended")]),t._v(" "),s("td")])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("方法")]),t._v(" "),s("th"),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("getConstraints()")]),t._v(" "),s("td",[t._v("applyConstraints()")]),t._v(" "),s("td",[t._v("getSettings()")])]),t._v(" "),s("tr",[s("td",[t._v("getCapabilities()")]),t._v(" "),s("td",[t._v("clone")]),t._v(" "),s("td",[t._v("stop()")])])])]),t._v(" "),s("h3",{attrs:{id:"rtcpeerconnection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rtcpeerconnection"}},[t._v("#")]),t._v(" RTCPeerConnection")]),t._v(" "),s("p",[t._v("RTCPeerConnection 接口代表一个由本地计算机到远端的 WebRTC 连接。该接口提供了创建，保持，监控，关闭连接的方法的实现。、")]),t._v(" "),s("p",[t._v("我们虽然把 WebRTC 称之为点对点的连接，但并不意味着，实现过程中不需要服务器的参与。因为在点对点的信道建立起来之前，二者之间是没有办法通信的。这也就意味着，在信令阶段，我们需要一个通信服务来帮助我们建立起这个连接。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//兼容性处理")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" PeerConnection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RTCPeerConnection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mozRTCPeerConnection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webkitRTCPeerConnection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" iceServers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stun:stun.l.google.com:19302"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 谷歌的公共服务")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"turn:***"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户名")]),t._v("\n          credential"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 密码")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" peer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PeerConnection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iceServers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("事件")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("onaddstream")])]),t._v(" "),s("td",[t._v("当一个媒体流从远程对等体添加到PeerConnection连接中时")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("ondatachannel")])]),t._v(" "),s("td",[t._v("当一个RTC数据通道添加到连接中")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("onicecandidate")])]),t._v(" "),s("td",[t._v("当一个ICE候选添加到备选池中")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("oniceconnectionstatechang")])]),t._v(" "),s("td",[t._v("当一个连接对象的状态发生改变时")])]),t._v(" "),s("tr",[s("td",[t._v("onidentityresult")]),t._v(" "),s("td",[t._v("当身份断言生成时")])]),t._v(" "),s("tr",[s("td",[t._v(".onidpassertionerror")]),t._v(" "),s("td",[t._v("当身份断言关联的身份提供者遇到一个错误时")])]),t._v(" "),s("tr",[s("td",[t._v("onidpvalidation")]),t._v(" "),s("td",[t._v("当身份验证出错时")])]),t._v(" "),s("tr",[s("td",[t._v("onsignalingstatechange")]),t._v(" "),s("td",[t._v("当signalingstate更改的值时")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("onremovestream")])]),t._v(" "),s("td",[t._v("当从此连接中删除mediastream时")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("方法")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("RTCPeerConnection()")])]),t._v(" "),s("td",[t._v("构造函数，通过new，返回一个RTC对等体连接对象")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("createOffer()")])]),t._v(" "),s("td",[t._v("呼叫方发送一个offer请求（成功回调，失败回调，配置对象）")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("createAnswer()")])]),t._v(" "),s("td",[t._v("被呼叫方发送一个answer应答（成功回调，失败回调，配置对象）")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("setLocalDesccription()")])]),t._v(" "),s("td",[t._v("设置与连接相关的本地描述")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("setRemoteDescription()")])]),t._v(" "),s("td",[t._v("设置与连接相关的远端描述")])]),t._v(" "),s("tr",[s("td",[t._v("getLocalStreams()")]),t._v(" "),s("td",[t._v("返回连接的本地媒体流数组")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("getRemoteStreams()")])]),t._v(" "),s("td",[t._v("返回连接的远端媒体流数组")])]),t._v(" "),s("tr",[s("td",[t._v("addStream()")]),t._v(" "),s("td",[t._v("添加一个媒体流")])]),t._v(" "),s("tr",[s("td",[t._v("removeStream()")]),t._v(" "),s("td",[t._v("移除一个媒体流")])]),t._v(" "),s("tr",[s("td",[t._v("close()")]),t._v(" "),s("td",[t._v("关闭一个RTCPeerConnection实例")])]),t._v(" "),s("tr",[s("td",[t._v("createDataChannel()")]),t._v(" "),s("td",[t._v("建立一个新的DC通道")])])])]),t._v(" "),s("p",[t._v("基本用法")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" pc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RTCPeerConnection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onaddstream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"video"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  vid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srcObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("呼叫方")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" offerconf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    offerToReceiveAudio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    offerToReceiveVideo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    iceRestart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nnavigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserMedia")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("video"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("stream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onaddstream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    pc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n    pc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createOffer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offerconf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("offer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        pc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setLocalDescription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendOffer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("应答方")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pc.setRemoteDescription(offer).then(()=>{\n\tpc.createAnswer().then((answer)=>{\n\t\tpc.setLocalDescription(answer).then(()=>{\n\t\t\tsendAnswer()\n\t\t})\n\t})\n})\n")])])]),s("p",[s("img",{attrs:{src:"https://static.bookstack.cn/projects/webrtc-book-cn/images/rcwr_0501.png",alt:"img"}})]),t._v(" "),s("h3",{attrs:{id:"datachannel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#datachannel"}},[t._v("#")]),t._v(" DataChannel")]),t._v(" "),s("p",[t._v("RTCDataChannel接口代表在两者之间建立一个双向数据的通道，用于发送非音视频的信息。")]),t._v(" "),s("p",[t._v("可以用createDataChannel()或者在现有的RTCPeerConnection实例上用ondatachannel事件接受，创建出RTCDataChannel类型的对象。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" pc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RTCPeerConnection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" dc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDataChannel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my channel"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"received: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"datachannel open"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"datachannel close"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"datachannel error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("属性")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("label")]),t._v(" "),s("td",[t._v("描述通道名字的一个字符串，这个字段可以不唯一")])]),t._v(" "),s("tr",[s("td",[t._v("ordered")]),t._v(" "),s("td",[t._v("返回一个Boolean，表示传递信息的顺序是否有保证")])]),t._v(" "),s("tr",[s("td",[t._v("protocol")]),t._v(" "),s("td",[t._v("返回正在使用的子协议的名称，一个字符串，没有则返回“”")])]),t._v(" "),s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("当RTCDdataChannel对象被创建时，作为通道的唯一标识")])]),t._v(" "),s("tr",[s("td",[t._v("readyState")]),t._v(" "),s("td",[t._v("表示数据连接的状态")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("事件")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("onopen")]),t._v(" "),s("td",[t._v("当底层数据链路传输成功时")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("onmessage")])]),t._v(" "),s("td",[t._v("当有数据被接受时")])]),t._v(" "),s("tr",[s("td",[t._v("onclose")]),t._v(" "),s("td",[t._v("当底层链路被关闭时")])]),t._v(" "),s("tr",[s("td",[t._v("onerror")]),t._v(" "),s("td",[t._v("当遇到错误时")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("方法")]),t._v(" "),s("th")])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("close()")]),t._v(" "),s("td",[t._v("关闭channel，不会立即生效，等消息队列的数据发送完毕之后，channe才会被关闭")])]),t._v(" "),s("tr",[s("td",[t._v("send()")]),t._v(" "),s("td",[t._v("将参数中的数据通过channel通道发送")])])])]),t._v(" "),s("h3",{attrs:{id:"sdp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sdp"}},[t._v("#")]),t._v(" SDP")]),t._v(" "),s("p",[t._v("WebRTC 使用 Offer-Answer 模型交换 SDP，Offer 中有 SDP，Answer 中也有。例如 Alice 和 Bob 通过 WebRTC 通信：")]),t._v(" "),s("p",[t._v("Alice Offer")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("// Session description\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("v")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# version SDP 协议版本，值固定为 0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("o")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2397106153131073818")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" IN IP4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# origin 代表会话的发起者")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("s")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# session name 会话的名称，每个 SDP 中有且仅能有一个 s 描述，其值不能为空")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("c")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("IN IP4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\nconnection data \n// Time description\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("t")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" 携带了会话的连接信息，其实就是 IP 地址\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# timing 指定了会话的开始和结束时间，如果开始和结束时间都为 0，那么意味着这次会话是永久的")]),t._v("\n\n// Session Attribute\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("group:BUNDLE video\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("msid-semantic: WMS gLzQPGuagv3xXolwPiiGAULOwOLNItvl8LyS\n\n// Media description\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("m")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("video "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" UDP/TLS/RTP/SAVPF "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("96")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("97")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# m=<media> <port> <proto> <fmt> ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("c")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("IN IP4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp:9 IN IP4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ice-ufrag:l5KU\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ice-pwd:+Sxmm3PoJUERpeHYL0HW4/T9\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ice-options:trickle\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fingerprint:sha-256 7C:93:85:40:01:07:91:BE:DA:64:A0:37:7E:61:CB:9D:91:9B:44:F6:C9:AC:3B:37:1C:00:15:4C:5A:B5:67:74\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("setup:actpass\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mid:video\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sendrecv\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-mux\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-rsize\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtpmap:96 VP8/90000\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 goog-remb\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 transport-cc\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 ccm fir\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 nack\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 nack pli\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtpmap:97 rtx/90000\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fmtp:97 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("apt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("96")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc-group:FID "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2527104241")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:2527104241 cname:JPmKBgFHH5YVFyaJ\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:2527104241 msid:gLzQPGuagv3xXolwPiiGAULOwOLNItvl8LyS c7072509-df47-4828-ad03-7d0274585a56\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:2527104241 mslabel:gLzQPGuagv3xXolwPiiGAULOwOLNItvl8LyS\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:2527104241 label:c7072509-df47-4828-ad03-7d0274585a56\n")])])]),s("p",[t._v("Bob Answer")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("v")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("o")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5443219974135798586")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" IN IP4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("s")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("t")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("group:BUNDLE video\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("msid-semantic: WMS uiZ7cB0hsFDRGgTIMNp6TajUK9dOoHi43HVs\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("m")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("video "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" UDP/TLS/RTP/SAVPF "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("96")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("97")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("c")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("IN IP4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp:9 IN IP4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ice-ufrag:MUZf\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ice-pwd:4QhikLcmGXnCfAzHDB++ZjM5\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ice-options:trickle\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fingerprint:sha-256 2A:5A:B8:43:66:05:B3:6A:E9:46:36:DF:DF:20:11:6A:F6:11:EA:D9:4E:26:E3:CE:5A:3A:C6:8D:03:49:7B:DE\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("setup:active\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mid:video\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sendrecv\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-mux\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-rsize\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtpmap:96 VP8/90000\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 goog-remb\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 transport-cc\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 ccm fir\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 nack\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtcp-fb:96 nack pli\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtpmap:97 rtx/90000\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fmtp:97 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("apt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("96")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc-group:FID "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3587783331")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:3587783331 cname:INxZnBV2Sty1zlmN\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:3587783331 msid:uiZ7cB0hsFDRGgTIMNp6TajUK9dOoHi43HVs a3b297e7-cdbe-464e-a32c-347465ace055\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:3587783331 mslabel:uiZ7cB0hsFDRGgTIMNp6TajUK9dOoHi43HVs\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ssrc:3587783331 label:a3b297e7-cdbe-464e-a32c-347465ace055\n")])])]),s("p",[t._v("注意：SDP Line 是顺序相关的，比如 "),s("code",[t._v("a=rtpmap:96")]),t._v(" 后面的都是它相关的设置，直到下一行是 "),s("code",[t._v("a=rtpmap")]),t._v("或者其他属性")]),t._v(" "),s("p",[t._v("交换完 SDP 后，会交换 Candidate：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("// Alice Candidate\ncandidate: candidate:1912876010 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" udp "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2122260223")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.2")]),t._v(".220.94 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("52832")]),t._v(" typ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" generation "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" ufrag l5KU network-id "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" network-cost "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\ncandidate: candidate:1015535386 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" tcp "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1518280447")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.2")]),t._v(".220.94 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" typ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" tcptype active generation "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" ufrag l5KU network-id "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" network-cost "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n// Bob Candidate\ncandidate:1912876010 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" udp "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2122260223")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.2")]),t._v(".220.94 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("51551")]),t._v(" typ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" generation "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" ufrag MUZf network-id "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" network-cost "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])])]),s("h3",{attrs:{id:"sfu"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sfu"}},[t._v("#")]),t._v(" SFU")]),t._v(" "),s("p",[t._v("MediaSoup 这种 SFU，客户端先给一个 Offer 给 SFU，SFU 只是检查这个 Offer 中的媒体特性，然后 SFU 会生成 Offer（包含会议中的其他客户端的流，如果没有人则没有 SSRC）给客户端，客户端发送 Answer 给 SFU。这种方式的好处是其他客户端加入，以及流的变更（比如关闭视频打开视频时），都可以使用 Reoffer，也就是统一由 SFU 发起新的 Offer，客户端响应，SFU 和客户端的交互模式只有一种。")])])}),[],!1,null,null,null);a.default=e.exports}}]);